machine:
  node:
    version: 5.0.0
  ruby:
    version: 2.2.0

services:
  - mysql

before_script:
  - mysql -e 'create database server_test;'
  - mv server/config/database.ci.yml server/config/database.yml

dependencies:
  override:
    - cd client && npm install
    - cd client && npm install -g gulp

    - cd server && gem install bundler
    - cd server && bundle -j4 --path=vendor/bundle
    - cd server && bundle install

test:
  override:
    - cd client && npm run build

    - cd server && bundle exec rake db:create
    - cd server && bundle exec rake db:migrate
    - cd server && bundle exec rake test
